version: '2'

services:
   db:
     image: mysql:5.7
     volumes:
       - db_data:/var/lib/mysql
       - ./mysql/my.cnf:/etc/mysql/conf.d/my.cnf
     restart: always
     env_file: database.properties
     environment:
       MYSQL_DATABASE: kontalk
       MYSQL_USER: kontalk

   tigase:
     depends_on:
       - db
     image: kontalk/xmppserver
     ports:
       - "8222:5222"
     volumes:
       - ./data/init.properties.dist:/tmp/init.properties.dist
       - ./entrypoint.sh:/home/kontalk/entrypoint.sh
     restart: always
     env_file: tigase.properties
     environment:
       MYSQL_DATABASE: kontalk
       MYSQL_USER: kontalk
     user: kontalk
     entrypoint: ./entrypoint.sh

volumes:
    db_data:
